# Build Request: reminders

## Overview
A reminders skill that allows me to set, manage, and proactively deliver reminders to Rob via Discord. Key features:

1. **Create reminders** — Parse natural language time expressions ("tomorrow at 2pm", "in 2 hours", "next Friday morning") and store them with a message
2. **Background ticker** — A setInterval loop (every 60s) that checks for due reminders and sends them to a Discord channel proactively (not as a tool response — as a new message)
3. **Persistent storage** — All reminders stored in `data/reminders.json`, survives restarts and promotions
4. **Missed reminders** — On init/startup, immediately fire any reminders that were due while the bot was offline
5. **List reminders** — Show all pending reminders with their scheduled times
6. **Cancel reminders** — Cancel by ID or fuzzy match on the reminder text
7. **Snooze reminders** — When a reminder fires, ability to snooze it (default 15 min, configurable)
8. **History** — Sent reminders move to a "sent" array with timestamp, kept for 30 days, auto-cleaned
9. **Timezone** — All times in Australia/Sydney (AEDT/AEST)

The skill needs an `init(discordClient)` function exported alongside the normal handler. This init function:
- Receives the Discord client reference
- Stores the channel ID from env (WAKE_CHANNEL_ID as default, or a REMINDER_CHANNEL_ID if set)
- Starts the background ticker interval
- Checks for any missed reminders immediately

The handler.js should export: { init, execute }

Actions for the tool handler:
- "create" — params: { message, time (natural language string) }
- "list" — no params, returns all pending reminders
- "cancel" — params: { id or searchText }
- "snooze" — params: { id, duration (optional, default "15 minutes") }
- "history" — show recently sent reminders

## Skill Architecture
This is a MiniClaw Discord bot skill. Each skill is a self-contained folder with:
- `handler.js` — The main module. MUST export:
  - `toolDefinition` — An Anthropic tool_use schema object ({ name, description, input_schema })
  - `execute(input)` — An async function that receives the tool input and returns a result object
- `SKILL.md` — Documentation: what the skill does, when to use it, example trigger phrases
- `PROGRESS.md` — Development log (append-only, timestamped entries)
- `data/` — Optional persistent data directory for JSON/text files

## Technical Requirements
- ES modules (import/export, no require())
- Node.js 20+ (no browser APIs)
- The skill runs inside a Discord bot on Windows — no network calls unless explicitly needed
- `process.cwd()` returns the MiniClaw project root
- The handler is loaded via dynamic import: `import('file:///path/to/handler.js')`
- All file operations should use `path.resolve()` for Windows compatibility
- Return objects from execute() — they get JSON-serialized and sent back to Claude API as tool results
- Errors should be returned as `{ success: false, error: 'message' }`, not thrown (unless truly fatal)

## Tool Definition Pattern
```javascript
export const toolDefinition = {
  name: 'reminders',
  description: 'Clear description of what this tool does and when to use it',
  input_schema: {
    type: 'object',
    properties: {
      action: {
        type: 'string',
        enum: ['action1', 'action2'],
        description: 'What operation to perform'
      }
      // ... more properties
    },
    required: ['action']
  }
};

export async function execute(input) {
  const { action } = input;
  switch (action) {
    case 'action1':
      return { success: true, data: '...' };
    default:
      return { success: false, error: `Unknown action: ${action}` };
  }
}
```

## Specific Requirements
- Use built-in Date parsing plus a lightweight approach for natural language time parsing (write a custom parser — do NOT rely on npm packages like chrono-node since we want zero dependencies)
- The custom time parser should handle: "in X minutes/hours/days", "tomorrow at Xpm/am", "next Monday", "Friday at 3pm", day-of-week references, "tonight", "this afternoon", relative expressions
- All times must be converted to and stored as ISO 8601 in Australia/Sydney timezone
- Reminders JSON structure: { pending: [...], sent: [...] }
- Each reminder: { id (uuid-like short string), message, createdAt, dueAt, status: "pending"|"sent"|"cancelled", sentAt (if sent) }
- The background ticker must be resilient — errors in one reminder shouldn't crash the loop
- Discord message format for fired reminders: "⏰ **Reminder:** {message}" (simple, clean)
- File I/O should be synchronous reads at startup, async writes otherwise
- Auto-clean sent reminders older than 30 days on each tick
- The init function needs to be called from the bot's startup code (src/discord.js or src/index.js) — document this integration point clearly in SKILL.md

## Example Trigger Phrases
These are the kinds of things the user might say that should activate this tool:
- "Remind me to check on the deployment tomorrow at 9am"
- "Set a reminder for Friday at 3pm to call the dentist"
- "What reminders do I have?"
- "Cancel the dentist reminder"
- "Snooze that for 30 minutes"
- "Show reminder history"

## Data Storage Notes
data/reminders.json — persistent storage for all reminders (pending and sent arrays)



## What to Build
1. Create `handler.js` with the full working implementation
2. Create `SKILL.md` with clear documentation
3. Create `PROGRESS.md` with an initial entry
4. Create the `data/` directory if the skill needs persistent storage
5. Make sure the code actually works — no placeholder TODOs

## Important
- The tool name in toolDefinition.name MUST be: `reminders`
- The skill folder is: `skills/reminders/`
- Write COMPLETE, WORKING code. Not stubs. Not placeholders. Real, functional code.
- Test your logic mentally — walk through the execute() function with sample inputs.
